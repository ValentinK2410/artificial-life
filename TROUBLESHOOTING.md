# üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º

## –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É"

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep "node.*server.js" | grep -v grep

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
netstat -tuln | grep 3000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
curl http://localhost:3000
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "status": "ok",
  "message": "Artificial Life Server is running",
  "environment": "production",
  "port": 3000,
  "host": "0.0.0.0",
  "socketio": "enabled"
}
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx

–í—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
bash CHECK_NGINX_CONFIG.sh
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Nginx –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ Unix socket, –∞ —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3000

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx –≤ ISPmanager:

1. –ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ `location /socket.io/`
2. –ó–∞–º–µ–Ω–∏—Ç–µ:
   ```nginx
   proxy_pass http://unix:/var/www/www-root/data/nodejs/0.sock;
   ```
   –ù–∞:
   ```nginx
   proxy_pass http://127.0.0.1:3000;
   ```

3. –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç–µ –±–ª–æ–∫ `location /`:
   ```nginx
   proxy_pass http://127.0.0.1:3000;
   ```

4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Nginx:
   ```bash
   sudo systemctl reload nginx
   ```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å: `https://game.dekan.pro` –∏–ª–∏ `http://game.dekan.pro`
   - –ù–ï –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: `http://localhost:3000` (–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)

2. **–û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:**
   - `xhr poll error` - –ø—Ä–æ–±–ª–µ–º–∞ —Å Nginx –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–æ–º
   - `timeout` - —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
   - `CORS` - –ø—Ä–æ–±–ª–µ–º–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ CORS
   - `NetworkError` - –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç—å—é –∏–ª–∏ Nginx

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP endpoint:**
   ```javascript
   // –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
   fetch('https://game.dekan.pro/health')
     .then(r => r.json())
     .then(console.log)
   ```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

**–õ–æ–≥–∏ Nginx:**
```bash
tail -50 /var/www/httpd-logs/game.dekan.pro.error.log
tail -50 /var/www/httpd-logs/game.dekan.pro.access.log
```

**–õ–æ–≥–∏ Node.js (–µ—Å–ª–∏ —á–µ—Ä–µ–∑ systemd):**
```bash
sudo journalctl -u artificial-life -n 50 -f
```

**–õ–æ–≥–∏ Node.js (–µ—Å–ª–∏ —á–µ—Ä–µ–∑ ISPmanager):**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ISPmanager
- –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: `ps aux | grep "node.*server.js"` –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥

### –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

**–ß–µ—Ä–µ–∑ ISPmanager:**
1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
3. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è `game.dekan.pro`
4. –ù–∞–∂–º–∏—Ç–µ "–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å"

**–í—Ä—É—á–Ω—É—é:**
```bash
# –ù–∞–π–¥–∏—Ç–µ PID –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep "node.*server.js" | grep -v grep

# –£–±–µ–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å (–∑–∞–º–µ–Ω–∏—Ç–µ PID)
kill <PID>

# –ò–ª–∏ —á–µ—Ä–µ–∑ ISPmanager –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
ps eww -p $(pgrep -f "node.*server.js") | grep -E "NODE_ENV|PORT|ALLOWED_ORIGINS"
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- `NODE_ENV=production` (–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
- `PORT=3000` (–∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —Ç–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `ALLOWED_ORIGINS=https://game.dekan.pro,http://game.dekan.pro` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω, –Ω–æ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ `localhost`, –∞ –Ω–µ –Ω–∞ `0.0.0.0`
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `backend/server.js` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
```javascript
const HOST = isProduction ? '0.0.0.0' : 'localhost';
```

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: Nginx –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 502 Bad Gateway
**–ü—Ä–∏—á–∏–Ω–∞:** Nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: `ps aux | grep "node.*server.js"`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx (—Å–º. –®–∞–≥ 2)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Unix socket (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: CORS –æ—à–∏–±–∫–∏
**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Ä–≤–µ—Ä –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –≤ `backend/server.js`:
```javascript
const allowedOrigins = process.env.ALLOWED_ORIGINS 
    ? process.env.ALLOWED_ORIGINS.split(',') 
    : ['https://game.dekan.pro', 'http://game.dekan.pro'];
```

#### –ü—Ä–æ–±–ª–µ–º–∞ 4: WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
**–ü—Ä–∏—á–∏–Ω–∞:** Nginx –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è WebSocket
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx –µ—Å—Ç—å:
```nginx
location /socket.io/ {
    proxy_pass http://127.0.0.1:3000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    ...
}
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
bash check-server.sh
bash CHECK_NGINX_CONFIG.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
curl http://localhost:3000
curl http://localhost:3000/health
curl https://game.dekan.pro
curl https://game.dekan.pro/health
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:
1. –°–æ–±–µ—Ä–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
   - –í—ã–≤–æ–¥ `check-server.sh`
   - –í—ã–≤–æ–¥ `CHECK_NGINX_CONFIG.sh`
   - –õ–æ–≥–∏ Nginx (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫)
   - –õ–æ–≥–∏ Node.js (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
   - –°–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Å –æ—à–∏–±–∫–∞–º–∏

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã:
   - `START_SERVER.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤–µ—Ä–∞
   - `DEBUG_CONNECTION.md` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - `NGINX_PORT_CONFIG.conf` - –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ—Ä—Ç–∞ 3000
