# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## ‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç!

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ ISPmanager.

## –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ ISPmanager

1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å ISPmanager
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **WWW ‚Üí Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
3. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å** –∏–ª–∏ **–î–æ–±–∞–≤–∏—Ç—å**
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:

   **–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
   - **–î–æ–º–µ–Ω**: `game.dekan.pro`
   - **–ü—É—Ç—å –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é**: `/var/www/www-root/data/www/game.dekan.pro/backend`
   - **–§–∞–π–ª –∑–∞–ø—É—Å–∫–∞**: `server.js`
   - **–ü–æ—Ä—Ç**: `3000` (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç, –∑–∞–ø–æ–º–Ω–∏—Ç–µ –µ–≥–æ!)
   - **–†–µ–∂–∏–º**: `Production`

   **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```
   NODE_ENV=production
   PORT=3000
   ```
   (–ó–∞–º–µ–Ω–∏—Ç–µ 3000 –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç)

5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –¥–ª—è WebSocket

1. –í ISPmanager –ø–µ—Ä–µ–π–¥–∏—Ç–µ: **WWW ‚Üí –î–æ–º–µ–Ω—ã ‚Üí game.dekan.pro**
2. –û—Ç–∫—Ä–æ–π—Ç–µ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** –∏–ª–∏ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
3. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã nginx**
4. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```nginx
# –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket –¥–ª—è Socket.io
location /socket.io/ {
    proxy_pass http://localhost:3000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 86400;
}

# –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤
location /api/ {
    proxy_pass http://localhost:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

**‚ö†Ô∏è –í–ê–ñ–ù–û**: –ó–∞–º–µ–Ω–∏—Ç–µ `3000` –Ω–∞ –ø–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É–∫–∞–∑–∞–ª–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!

5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
6. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Nginx (ISPmanager —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

## –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ backend —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
curl http://localhost:3000

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON:
# {"status":"ok","message":"Artificial Life Server is running",...}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://game.dekan.pro` (–∏–ª–∏ `http://game.dekan.pro`)
2. –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ñ–æ—Ä–º–æ–π –≤—Ö–æ–¥–∞
3. –í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è"
4. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - –ù–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –°–æ–æ–±—â–µ–Ω–∏–µ "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ —Å–µ—Ä–≤–µ—Ä—É"

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

### –õ–æ–≥–∏ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
–í ISPmanager: **WWW ‚Üí Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí game.dekan.pro ‚Üí –õ–æ–≥–∏**

### –õ–æ–≥–∏ Nginx:
```bash
tail -f /var/log/nginx/game.dekan.pro.error.log
tail -f /var/log/nginx/game.dekan.pro.access.log
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### ‚ùå "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É"

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ ISPmanager
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç: `lsof -i :3000` (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ø–æ—Ä—Ç)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ ISPmanager

### ‚ùå WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ `Upgrade` –∏ `Connection`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### ‚ùå "Cannot use import statement outside a module"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `package.json` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```bash
cat /var/www/www-root/data/www/game.dekan.pro/package.json
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å `"type": "module"`, –∞ –Ω–µ `"type": "commonjs"`.

–ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –æ–±–Ω–æ–≤–∏—Ç–µ:
```bash
cd /var/www/www-root/data/www/game.dekan.pro
git pull origin main
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –±—É–¥—É—â–µ–º

```bash
cd /var/www/www-root/data/www/game.dekan.pro
git pull origin main
cd backend
npm install --production
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ISPmanager
```

## –ì–æ—Ç–æ–≤–æ! üéâ

–ï—Å–ª–∏ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∏–≥—Ä–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ `https://game.dekan.pro`
